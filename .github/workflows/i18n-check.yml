# MediSync i18n Validation Workflow
#
# Validates translation files and detects hardcoded strings.
# This workflow ENFORCES "i18n by default" - it fails on any violation.
#
# Checks:
# - Translation key parity: All EN keys must exist in AR
# - Empty values: No empty translation strings
# - Interpolation consistency: {{variable}} must match between EN and AR
# - Hardcoded strings: Detect untranslated strings in components

name: i18n Validation

on:
  push:
    branches: [main, 'feature/**', 'bugfix/**']
    paths:
      - 'frontend/src/i18n/**'
      - 'frontend/src/**/*.tsx'
      - 'frontend/scripts/check-i18n.ts'
      - 'frontend/scripts/detect-hardcoded-strings.ts'
  pull_request:
    branches: [main]
    paths:
      - 'frontend/src/i18n/**'
      - 'frontend/src/**/*.tsx'
      - 'frontend/scripts/check-i18n.ts'
      - 'frontend/scripts/detect-hardcoded-strings.ts'
  workflow_call:
    # Allow this workflow to be called from other workflows

jobs:
  i18n-check:
    name: i18n Validation
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '24'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json

      - name: Install dependencies
        working-directory: frontend
        run: npm ci

      - name: Validate translation key parity (EN/AR)
        working-directory: frontend
        run: npm run i18n:check

      - name: Detect untranslated strings in components
        working-directory: frontend
        run: npm run i18n:detect

      - name: Summary
        if: success()
        run: |
          echo "âœ… i18n validation passed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- All translation keys exist in both EN and AR" >> $GITHUB_STEP_SUMMARY
          echo "- No empty translation values found" >> $GITHUB_STEP_SUMMARY
          echo "- No hardcoded strings detected" >> $GITHUB_STEP_SUMMARY
